#!/usr/bin/python3
#vim:filetype=py

import sys
import pathlib
import subprocess


PREV_FILE = '/tmp/e_file'
INPUT_FILE = '/tmp/e_input'


def read_executable(name):
    if not name.endswith('.py'):
        name += '.py'
    executable = pathlib.Path(name)
    print(executable)
    if not executable.exists():
        print('Not an executable')
        sys.exit(1)
    return executable


def catch_input():
    try:
        while True:
            yield input()
    except (EOFError, KeyboardInterrupt):
        return


def main():
    command = ['python3']

    repeat_last_input = False
    if len(sys.argv) > 1 and sys.argv[1] == 'r':
        repeat_last_input = True
        sys.argv.pop(1)

    for arg in (arg for arg in sys.argv if arg.startswith('-')):
        command.append(arg)
        sys.argv.remove(arg)

    def run_executable(executable):
        subprocess.run(command + [executable])
        with open(PREV_FILE, 'w') as f:
            f.write(str(executable.absolute()))

    if len(sys.argv) == 1:
        try:
            with open(PREV_FILE) as f:
                run_executable(read_executable(f.readline()))
        except FileNotFoundError:
            print('No prev file')
    else:
        run_executable(read_executable(sys.argv[1]))


main()

